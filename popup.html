<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <title>Wich Waysz - Quick Shop Submission</title>
    <link rel="stylesheet" href="css/styles.css" />
    <script src="js/htmx.min.js"></script>
    <script src="js/alpine.min.js"></script>
    <script src="js/script.js"></script>
  </head>
  <body x-data="{ showManual: false }">
    <h2>Add a Shop</h2>

    <form
      hx-post="https://*/api/addShop"
      hx-trigger="submit"
      hx-target="#response"
      hx-swap="innerHTML"
    >
      <input name="shopName" type="text" placeholder="Shop Name" required />
      <textarea
        name="shop_description"
        placeholder="Shop Description"
      ></textarea>
      <input name="website_url" type="url" placeholder="Website URL" />
      <input
        name="phone"
        type="text"
        placeholder="Phone (123) 456-7890"
        id="phoneInput"
      />
      <div class="flex justify-center">
        <div
          x-data="categoryDropdown()"
          x-on:keydown.escape.prevent.stop="close($refs.button)"
          x-on:focusin.window="!$refs.panel.contains($event.target) && close()"
          x-id="['dropdown-button']"
          class="relative w-full"
        >
          <button
            x-ref="button"
            x-on:click="toggle()"
            :aria-expanded="open"
            :aria-controls="$id('dropdown-button')"
            type="button"
            class="relative flex items-center justify-between w-full gap-2 py-2 px-4 rounded-lg shadow-sm bg-white hover:bg-gray-50 border border-gray-300 text-gray-700"
          >
            <span x-text="selected.length ? selected.length + ' Selected' : 'Select Categories'"></span>
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 16 16" fill="currentColor" class="size-4">
              <path fill-rule="evenodd" d="M4.22 6.22a.75.75 0 0 1 1.06 0L8 8.94l2.72-2.72a.75.75 0 1 1 1.06 1.06l-3.25 3.25a.75.75 0 0 1-1.06 0L4.22 7.28a.75.75 0 0 1 0-1.06Z" clip-rule="evenodd" />
            </svg>
          </button>
      
          <div
            x-ref="panel"
            x-show="open"
            x-transition.origin.top.left
            x-on:click.outside="close($refs.button)"
            :id="$id('dropdown-button')"
            x-cloak
            class="absolute left-0 right-0 mt-2 rounded-lg shadow-sm bg-white p-2 outline-none border border-gray-200 max-h-60 overflow-y-auto z-10"
          >
            <input 
              type="text" 
              x-model="search" 
              placeholder="Search categories..." 
              class="w-full mb-2 p-2 border border-gray-300 rounded"
            />
      
            <template x-for="category in filteredCategories()" :key="category.id">
              <div class="flex items-center p-2 hover:bg-gray-50 rounded">
                <input
                  type="checkbox"
                  :id="'category-' + category.id"
                  :value="category.id"
                  @change="toggleCategory(category.id)"
                  :checked="selected.includes(category.id)"
                  class="mr-2"
                />
                <label :for="'category-' + category.id" x-text="category.category_name" class="cursor-pointer"></label>
              </div>
            </template>
          </div>
      
          <template x-for="id in selected" :key="'hidden-' + id">
            <input type="hidden" name="categories" :value="id" />
          </template>
        </div>
      </div>
      
      

      <input
        name="address"
        id="addressInput"
        placeholder="Street Address"
        required
      />
      <button type="button" onclick="prefillAddress()">Prefill Address</button>
      <span id="loading" style="display: none">Loading...</span>

      <button type="button" @click="showManual = !showManual">
        <span
          x-text="showManual ? 'Hide Manual Entry' : 'Enter Address Manually'"
        ></span>
      </button>

      <div id="manualFields" x-show="showManual" style="margin-top: 1rem">
        <input
          name="house_number"
          id="house_number"
          placeholder="Street Number"
        />
        <input
          name="address_first"
          id="address_first"
          placeholder="Address Line 1"
        />
        <input
          name="address_second"
          id="address_second"
          placeholder="Address Line 2"
        />
        <input name="city" id="city" placeholder="City" />
        <input name="state" id="state" placeholder="State" />
        <input name="postcode" id="postcode" placeholder="Postcode" />
        <input name="country" id="country" placeholder="Country" />
        <input
          name="latitude"
          id="latitude"
          type="number"
          step="any"
          placeholder="Latitude"
        />
        <input
          name="longitude"
          id="longitude"
          type="number"
          step="any"
          placeholder="Longitude"
        />
      </div>

      <button type="submit">Submit Location</button>
    </form>

    <div id="response"></div>
  </body>
</html>
